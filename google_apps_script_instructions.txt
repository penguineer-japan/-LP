function doPost(e) {
  // 1. スプレッドシートの取得
  var sheet = SpreadsheetApp.getActiveSpreadsheet().getActiveSheet();
  
  // 2. フォームデータの取得（HTMLのname属性と一致させます）
  var params = e.parameter;
  var date = new Date();
  var company = params.company;   // 会社名
  var position = params.position; // 役職
  var name = params.name;         // お名前
  var email = params.email;       // メールアドレス
  var issue = params.issue;       // 解決したい課題
  var remarks = params.remarks;   // その他・ご要望（新規追加）

  // 課題のマッピング（英語→日本語）
  var issueMap = {
    'cost': '採用コストを下げたい',
    'entry': '応募を増やしたい',
    'quality': '応募者の質を改善したい',
    'time': '採用業務を丸投げしたい'
  };
  var issueText = issueMap[issue] || issue;

  // 3. シートへの書き込み
  // ※スプレッドシートの1行目にカラム名を追加してください：
  // [日時, 会社名, 役職, 名前, Email, 課題, その他]
  sheet.appendRow([date, company, position, name, email, issueText, remarks]);

  // 4. Larkへの通知機能 (Webhook URLを設定してください)
  // ※Starterプラン等でWebhookが使えない場合は無視して構いません
  var LARK_WEBHOOK_URL = "YOUR_LARK_WEBHOOK_URL_HERE"; 

  if (LARK_WEBHOOK_URL !== "YOUR_LARK_WEBHOOK_URL_HERE") {
    sendLarkNotification(LARK_WEBHOOK_URL, company, position, name, email, issueText, remarks);
  }

  // 5. 成功レスポンスを返す（JSON形式）
  var output = ContentService.createTextOutput(JSON.stringify({result: 'success'}));
  output.setMimeType(ContentService.MimeType.JSON);
  return output;
}

// Lark通知用関数
function sendLarkNotification(url, company, position, name, email, issue, remarks) {
  var message = {
    "msg_type": "text",
    "content": {
      "text": "【新規リード獲得！】\n" +
              "会社名: " + company + "\n" +
              "役職: " + position + "\n" +
              "名前: " + name + "\n" +
              "Email: " + email + "\n" +
              "課題: " + issue + "\n" +
              "その他: " + (remarks || "なし")
    }
  };

  var options = {
    "method": "post",
    "contentType": "application/json",
    "payload": JSON.stringify(message)
  };

  try {
    UrlFetchApp.fetch(url, options);
  } catch (e) {
    Logger.log("Lark Notification Failed: " + e.toString());
  }
}
